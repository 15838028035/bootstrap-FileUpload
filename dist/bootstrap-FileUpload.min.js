/*! Bootstrap FileUpload - v0.1.0 - 2016-02-24
* https://github.com/lleblanc42/bootstrap-FileUpload
* Copyright (c) 2016 Luke LeBlanc; Licensed GPL-3.0 */
!function(a,b,c){"use strict";a.fn.bootstrapFileUpload=function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p={url:null,fallbackUrl:null,formMethod:"post",multiFile:!0,multiUpload:!1,inputName:"files",hiddenInput:null,forceFallback:!1,maxSize:5,maxFiles:null,createThumb:!0,thumbWidth:80,thumbHeight:80,fileTypes:null,onInit:function(){},onFileAdded:function(){},onFileRemoved:function(){},onFileCancel:function(){},onFileProcessing:function(){},onUploadProgress:function(){},onUploadError:function(){},onUploadSuccess:function(){},onUploadComplete:function(){},onUploadReset:function(){}},q=a.extend(p,b||{}),r={},s=0,t=function(b){d=a("#"+b),A&&q.forceFallback===!1?(o=new FormData,e=a('<form action="'+(q.fallbackUrl?q.fallbackUrl:q.url)+'" method="'+q.formMethod+'" enctype="multipart/form-data"></form>'),f=a('<div class="row fileupload-buttonbar"></div>'),g=a('<div class="col-lg-7"></div>'),h=a('<div class="btn btn-success fileupload-add"><input type="file" '+(q.multiFile===!0?'multiple="multiple"':void 0)+'multiple /><i class="glyphicon glyphicon-plus"></i>&nbsp;Add Files&hellip;</div>'),k=a('<button type="reset" class="btn btn-primary fileupload-reset"><i class="glyphicon glyphicon-repeat"></i>&nbsp;Add More Files&hellip;</button>'),i=a('<button class="btn btn-warning fileupload-start"><i class="glyphicon glyphicon-upload"></i>&nbsp;<span>Start upload</span></button>'),j=a('<button type="reset" class="btn btn-danger fileupload-cancel"><i class="glyphicon glyphicon-ban-circle"></i>&nbsp;<span>Cancel upload</span></button>'),l=a('<div class="col-lg-5 fileupload-overall-progress"><div class="progress"><div class="progress-bar progress-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;"></div><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;"></div><div class="progress-extended">&nbsp;</div></div></div>'),m=a('<div class="row fileupload-overall-status"><div class="col-lg-12"><div class="alert alert-success"><strong>Uploaded Successfully!</strong></div><div class="alert alert-danger"></div></div></div>'),n=a('<table role="presentation" class="table table-striped fileupload-preview"><tbody class="files"></tbody></table>'),g.append(h,k,i,j),f.append(g,l),e.append(f,m),d.append(e,n),h.on("change","input",function(a){u(a)}),k.on("click",function(a){a.preventDefault(),y()}),i.on("click",function(a){a.preventDefault(),v()}),j.on("click",function(){y()}),n.on("click",".fileupload-remove",function(){x(a(this).val())})):(e=a('<form action="'+(q.fallbackUrl?q.fallbackUrl:q.url)+'" method="'+q.formMethod+'" enctype="multipart/form-data"></form>'),h=a('<div class="input-group"><span class="input-group-btn"><span class="btn btn-success fileupload-fallback-add"><i class="glyphicon glyphicon-plus"></i>&nbsp;Add Files&hellip; <input type="file" name="'+q.inputName+'" '+(q.multiFile===!0?'multiple="multiple"':void 0)+'></span></span><input type="text" class="form-control" readonly></div>'),i=a('<div class="form-group"><button type="submit" class="btn btn-warning fileupload-fallback-start"><i class="glyphicon glyphicon-upload"></i>&nbsp;<span>Start upload</span></button><button type="reset" class="btn btn-primary fileupload-fallback-reset"><i class="glyphicon glyphicon-repeat"></i>&nbsp;Reset</button></div>'),e.append(h,i),q.hiddenInput&&a.each(q.hiddenInput,function(a,b){e.append('<input type="hidden" name="'+a+'" value="'+b+'" />')}),d.append(e),h.on("change",".fileupload-fallback-add input[type=file]",function(){var b,c,d;b=a(this),c=b.get(0).files?b.get(0).files.length:1,d=b.val().replace(/\\/g,"/").replace(/.*\//,""),b.trigger("fileselect",[c,d])}),h.find(".fileupload-fallback-add input[type=file]").on("fileselect",function(b,c,d){var e,f;e=a(this).parents(".input-group").find("input[type=text]"),f=c>1?c+" files selected":d,e.length&&e.val(f)})),"function"==typeof q.onInit&&q.onInit.call()},u=function(a){i.fadeIn("slow","linear"),j.fadeIn("slow","linear");var b=a.target.files,e=b.length;q.multiFile===!0&&q.maxFiles&&e>q.maxFiles&&(c.alert("You're trying to upload "+e+" files and only "+q.maxFiles+" files is currently supported! The system will only upload what is supported and you will have to upload again."),e=q.maxFiles),n.detach();for(var f=0;e>f;f++){var g,h,k,l;if(g="file-"+f,h=b[f],k=h.size/1024/1024,!q.fileTypes||h.type.match(q.fileTypes))if(k.toFixed(2)>q.maxSize)c.alert('The file size for "'+h.name+'" is too large! Maximum supported file size is '+q.maxSize+"MB and the size of the file is "+k+"MB");else if(r&&z(h)>=0)c.alert('The file "'+h.name+'" is already in queue!');else{r[g]=h,s=++s;var m='<img src="'+URL.createObjectURL(h)+'" alt="'+h.name+'" width="'+q.thumbWidth+'px" height="'+q.thumbHeight+'px" class="fileupload-previewimg" />',o='<div class="progress fileupload-progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;"></div><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;"></div><div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;"></div></div><div class="alert alert-success"><strong>Uploaded Successfully!</strong></div><div class="alert alert-danger"></div>';l=q.createThumb===!0?q.multiUpload===!1?'<tr class="fileupload-previewrow thumb row" id="'+g+'"><td class="col-lg-1">'+m+'</td><td class="col-lg-4">'+h.name+'</td><td class="col-lg-6">'+o+'</td><td class="col-lg-1"><button class="btn btn-danger fileupload-remove" value="'+g+'"><i class="glyphicon glyphicon-ban-circle"></i>&nbsp;<span>Remove File</span></button></td></tr>':'<tr class="fileupload-previewrow thumb row" id="'+g+'"><td class="col-lg-1">'+m+'</td><td class="col-lg-9">'+h.name+'</td><td class="col-lg-2"><button class="btn btn-danger fileupload-remove" value="'+g+'"><i class="glyphicon glyphicon-ban-circle"></i>&nbsp;<span>Remove File</span></button></td></tr>':q.multiUpload===!1?'<tr class="fileupload-previewrow no-thumb row" id="'+g+'"><td class="col-lg-5">'+h.name+'</td><td class="col-lg-6">'+o+'</td><td class="col-lg-1"><button class="btn btn-danger fileupload-remove" value="'+g+'"><i class="glyphicon glyphicon-ban-circle"></i>&nbsp;<span>Remove File</span></button></td></tr>':'<tr class="fileupload-previewrow no-thumb row" id="'+g+'"><td class="col-lg-10">'+h.name+'</td><td class="col-lg-2"><button class="btn btn-danger fileupload-remove" value="'+g+'"><i class="glyphicon glyphicon-ban-circle"></i>&nbsp;<span>Remove File</span></button></td></tr>',n.append(l)}else c.alert('The file "'+h.name+'" is not a supported filetype!')}d.append(n),n.fadeIn("slow","linear"),"function"==typeof q.onFileAdded&&q.onFileAdded.call()},v=function(){a(".fileupload-add").attr("disabled","disabled"),a(".fileupload-start").attr("disabled","disabled"),a(".fileupload-cancel").attr("disabled","disabled"),a(".fileupload-remove").attr("disabled","disabled"),q.hiddenInput&&a.each(q.hiddenInput,function(a,b){o.append(a,b)}),q.multiUpload===!1?a.each(r,function(b,c){o.append(q.inputName,c),a("#"+b+" .fileupload-progress .progress-bar-striped").fadeIn("slow","linear"),a.ajax({url:q.url,type:q.formMethod,data:o,cache:!1,contentType:!1,processData:!1,accepts:"json",success:function(c,d,e){var f=JSON.parse(c);f.error?(a("#"+b+" .fileupload-progress .progress-bar-striped").attr("aria-valuenow",0).css("width","0%"),a("#"+b+" .fileupload-progress .progress-bar-danger").attr("aria-valuenow",100).css("width","100%"),a("#"+b+" .alert-danger").fadeIn("slow","linear").html("<strong>Error:</strong><br />"+f.error)):(a("#"+b+" .fileupload-progress .progress-bar-striped").attr("aria-valuenow",0).css("width","0%"),a("#"+b+" .fileupload-progress .progress-bar-success").attr("aria-valuenow",100).css("width","100%"),a("#"+b+" .alert-success").fadeIn("slow","linear")),"function"==typeof q.onUploadSuccess&&q.onUploadSuccess.call()},error:function(c,d,e){a("#"+b+" .fileupload-progress .progress-bar-striped").attr("aria-valuenow",0).css("width","0%"),a("#"+b+" .fileupload-progress .progress-bar-danger").attr("aria-valuenow",100).css("width","100%"),a("#"+b+" .alert-danger").fadeIn("slow","linear").html(d+": "+e.message),"function"==typeof q.onUploadError&&q.onUploadError.call()},xhr:function(){var c=a.ajaxSettings.xhr();return c.upload&&c.upload.addEventListener("progress",function(c){if(c.lengthComputable){var d=c.loaded/c.total;a("#"+b+" .fileupload-progress .progress-bar-striped").attr("aria-valuenow",Math.round(100*d)).css("width",Math.round(100*d)+"%")}}),c}}),"function"==typeof q.onUploadProgress&&q.onUploadProgress.call()}):(l.fadeIn("slow","linear"),a.each(r,function(a,b){o.append(q.inputName+"[]",b)}),a.ajax({url:q.url,type:q.formMethod,data:o,cache:!1,contentType:!1,processData:!1,accepts:"json",success:function(a,b,c){var d=JSON.parse(a);d.error?(l.find(".progress-bar-striped").attr("aria-valuenow",0).css("width","0%"),l.find(".progress-bar-danger").attr("aria-valuenow",100).css("width","100%"),m.fadeIn("slow","linear"),m.find(".alert-danger").fadeIn("slow","linear").html("<strong>Error:</strong><br />"+d.error)):(l.find(".progress-bar-striped").attr("aria-valuenow",0).css("width","0%"),l.find(".progress-bar-success").attr("aria-valuenow",100).css("width","100%"),m.fadeIn("slow","linear"),m.find(".alert-success").fadeIn("slow","linear")),"function"==typeof q.onUploadSuccess&&q.onUploadSuccess.call()},error:function(a,b,c){l.find(".progress-bar-striped").attr("aria-valuenow",0).css("width","0%"),l.find(".progress-bar-danger").attr("aria-valuenow",100).css("width","100%"),m.fadeIn("slow","linear"),m.find(".alert-danger").fadeIn("slow","linear").html(b+": "+c.message),"function"==typeof q.onUploadError&&q.onUploadError.call()},xhr:function(){var b=a.ajaxSettings.xhr();return b.upload&&b.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;l.find(".progress-bar-striped").attr("aria-valuenow",Math.round(100*b)).css("width",Math.round(100*b)+"%"),"function"==typeof q.onUploadProgress&&q.onUploadProgress.call()}}),b}})),h.fadeOut("slow","linear"),i.fadeOut("slow","linear"),j.fadeOut("slow","linear"),k.delay(600).fadeIn("slow","linear"),"function"==typeof q.onUploadComplete&&q.onUploadComplete.call()},w=function(){n.find("tbody").empty(),e[0].reset(),r={},s=0},x=function(b){1>=s?y():(a("#"+b).fadeOut("slow","linear"),a("#"+b+" .alert").fadeOut("slow","linear"),a("#"+b).remove(),delete r[b],s=--s),"function"==typeof q.onFileRemoved&&q.onFileRemoved.call()},y=function(){w(),n.fadeOut("slow","linear"),i.fadeOut("slow","linear"),j.fadeOut("slow","linear"),a(".fileupload-previewrow .alert").fadeOut("slow","linear"),a(".fileupload-add").removeAttr("disabled"),a(".fileupload-start").removeAttr("disabled"),a(".fileupload-cancel").removeAttr("disabled"),a(".fileupload-add").delay(800).fadeIn("slow","linear"),l.find(".progress-bar-success").attr("aria-valuenow",0).css("width","0%"),l.fadeOut("slow","linear"),k.fadeOut("slow","linear"),"function"==typeof q.onUploadReset&&q.onUploadReset.call()},z=function(b){var c=[];return a.each(r,function(a,b){c.push(b.name)}),a.inArray(b.name,c)},A=function(){var a=new XMLHttpRequest;return!!(c.FormData&&a&&"upload"in a&&"onprogress"in a.upload)};return this.each(function(){t(this.id)})}}(jQuery,document,window);